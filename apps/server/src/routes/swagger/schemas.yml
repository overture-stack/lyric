# Descriptions of common components

components:
  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/responses/Error'
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/responses/Error'

    StateConflict:
      description: State Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/responses/Error'

    UnauthorizedError:
      description: Access token is missing or invalid
      content:
        application/json:
          schema:
            $ref: '#/components/responses/Error'

    ServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/responses/Error'

    ServiceUnavailableError:
      description: Service Unavailable Error
      content:
        application/json:
          schema:
            $ref: '#/components/responses/Error'

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error type
        message:
          type: string
          decription: Description of the error

  schemas:
    CreateSubmissionResult:
      required:
        - state
        - description
        - batchErrors
        - inProcessEntities
      type: object
      properties:
        state:
          type: string
          description: Result of uploading Submission files
          enum: ['PROCESSING', 'INVALID_SUBMISSION', 'PARTIAL_SUBMISSION']
        description:
          type: string
          description: Description of uploading Submission files
        batchErrors:
          type: array
          description: list of all batch related errors, should be empty on success
          items:
            $ref: '#/components/schemas/BatchError'
        inProcessEntities:
          type: array
          description: Entities that are being processed
          items:
            type: string
    CommitSubmissionResult:
      required:
        - status
        - dictionary
      type: object
      properties:
        status:
          type: string
          description: Result of Commiting Submission
          enum: ['SUCCESS', 'FAILED']
        dictionary:
          type: object
          description: The dictionary used to commit submission
          properties:
            name:
              type: string
            version:
              type: string
        processedEntities:
          type: array
          description: Entities that are being processed
          items:
            type: string
    ActiveSubmissionResult:
      type: object
      properties:
        id:
          type: number
          description: Id of the Submission
        state:
          type: string
          description: State of the Submission
          enum: ['OPEN', 'VALID', 'INVALID', 'CLOSED', 'COMMITED']
        organization:
          type: string
          description: Organization the Submission belongs to
        data:
          type: object
          additionalProperties:
            type: object
            properties:
              creator:
                type: string
                description: The user who created the submission
              records:
                type: array
                items:
                  type: object
                  description: Content of the file in JSON format
              batchName:
                type: string
                description: Original filename  of the submission
              dataErrors:
                type: array
                items:
                  $ref: '#/components/schemas/ValidationError'
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: '#/components/schemas/ValidationError'
        createdAt:
          type: string
          description: The date/time of the creation
        createdBy:
          type: string
          description: The user who created the submission
        udpatedAt:
          type: string
          description: The date/time of the last update
        updatedBy:
          type: string
          description: The user who last updated the submission
        dictionary:
          type: object
          description: The dictionary used to validate submission
          properties:
            name:
              type: string
            version:
              type: string
        dictionaryCategory:
          type: object
          description: The Category to which this dictionary belongs
          properties:
            id:
              type: number
            name:
              type: string
    GetSubmittedDataResult:
      type: array
      items:
        type: object
        properties:
          data:
            type: array
            items:
              type: object
              description: Content of the file in JSON format
          entityName:
            type: string
          isValid:
            type: boolean
          organization:
            type: string

    QuerySubmittedDataResult:
      type: array
      items:
        type: object
        properties:
          data:
            type: array
            items:
              type: object
              description: Content of the file in JSON format
          entityName:
            type: string
          isValid:
            type: boolean
          organization:
            type: string
    ValidationError:
      type: object
      required:
        - index
        - type
        - fieldName
      properties:
        fieldName:
          type: string
          description: the field name that the error is related to
        info:
          type: object
          description: contains context information related to the error
          properties:
            value:
              type: array
              description: the faulty value
              items:
                type: string
        index:
          type: number
          format: integer
          description: the 0 based index of the row for this error
        errorType:
          type: string
          description: the type of error
          enum:
            - INVALID_BY_RANGE
            - INVALID_BY_REGEX
            - INVALID_BY_SCRIPT
            - INVALID_ENUM_VALUE
            - INVALID_FIELD_VALUE_TYPE
            - MISSING_REQUIRED_FIELD
            - UNRECOGNIZED_FIELD
        message:
          type: string
          description: Details of the error
    BatchError:
      type: object
      properties:
        message:
          type: string
          description: a message describing the error
        type:
          type: string
          description: the type of error
          enum:
            - INCORRECT_SECTION
            - INVALID_FILE_EXTENSION
            - INVALID_FILE_NAME
            - MISSING_REQUIRED_HEADER
            - MULTIPLE_TYPED_FILES
            - TSV_PARSING_FAILED
            - UNRECOGNIZED_HEADER
        batchName:
          type: array
          description: list of batch names causing error
          items:
            type: string
